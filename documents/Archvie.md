# RPS Arena 개발 아카이브

이 문서는 'RPS Arena' 가위바위보 서바이벌 게임의 아이디어 구체화부터 최종 완성까지의 개발 과정, 기술적 결정, 그리고 마주했던 문제들을 기록합니다.

---

### Phase 1: 프로젝트 초기 설정 및 핵심 기능 구현

- **기술 스택 선정**:

  - **Next.js (React)**: SSR의 이점과 간편한 라우팅, TypeScript 기본 지원으로 선택했습니다.
  - **Socket.IO**: WebSocket 기반 실시간 통신을 안정적으로 구현하고, 이벤트 기반 아키텍처를 손쉽게 구축하기 위해 채택했습니다.
  - **Node.js (Next.js 커스텀 서버)**: `server.ts`에서 HTTP 서버와 Socket.IO 서버를 통합하여 하나의 프로세스로 관리함으로써 구조를 단순화했습니다.

- **기본 구조 설계**:

  - **SocketContext**: React Context API를 사용해 Socket 인스턴스를 전역적으로 관리, 불필요한 props drilling을 방지하고 컴포넌트 어디서든 소켓에 접근할 수 있게 했습니다.
  - **중앙화된 타입 관리**: `types.ts` 파일을 두어 서버와 클라이언트가 공유하는 데이터(`Room`, `Player` 등)의 타입을 일관되게 유지하고, TypeScript의 장점을 극대화했습니다.

- **초기 기능 구현**:
  - **Socket 이벤트 정의**: `create_room`, `join_room`, `make_choice` 등 핵심 이벤트를 정의하고 서버에서 인메모리 객체(`rooms`)로 상태를 관리하는 방식을 택했습니다. 이는 외부 DB 없이 빠르게 프로토타입을 제작하기에 적합했습니다.

---

### Phase 2: 서바이벌 게임 메카닉 도입

단순 단판 게임에서 벗어나, 여러 라운드를 진행하며 긴장감을 높이는 서바이벌 방식으로 전환했습니다.

- **상태 관리 확장**:
  - `Player`에 `status` ('playing', 'eliminated')를, `Room`에 `gameState` ('waiting', 'playing')를 추가하여 더 복잡해진 게임 흐름을 체계적으로 관리했습니다.
- **게임 루프 설계**:
  - `startRound` 함수를 중심으로 비동기 게임 루프를 구현했습니다. `setInterval`로 5초 타이머를 만들고, 종료 시점에 모든 플레이어의 선택을 취합하여 승패를 판정했습니다.
  - **고민**: `setTimeout`과 `setInterval`의 연쇄 호출 구조가 서버에 부담을 주지 않을까 우려했지만, 각 라운드 사이에 4초의 지연 시간을 두어 이벤트 루프에 충분한 여유를 주도록 설계했습니다.

---

### Phase 3: 사용자 경험(UX) 및 커스텀 기능 강화

게임의 리플레이 가치를 높이고 사용자에게 더 많은 선택지를 제공하는 데 집중했습니다.

- **'당첨 순위' 시스템**:
  - '최후의 1인'이라는 단일 목표에서 벗어나 "N등 안에 들기"라는 새로운 목표를 제시했습니다. 이는 사용자가 게임의 난이도와 목표를 직접 설정하는 재미를 주었습니다.
  - **구현**: 탈락자가 발생할 때마다 `(남은 플레이어 수 + 1)` 공식을 사용해 순위를 계산하고 `rankedPlayers` 배열에 저장했습니다. 매 라운드 종료 시, 이 배열을 확인하여 목표 순위 달성 여부를 체크하는 로직을 추가했습니다.
- **UI 개선**:
  - 로비 화면을 탭 인터페이스로 변경하여 '방 만들기'와 '참가하기'의 구분을 명확히 했습니다. 이는 사용자가 원하는 행동을 더 빠르게 찾을 수 있도록 도왔습니다.

---

### Phase 4: 시각적 완성도 및 디테일 추가

사용자가 게임 상황을 더 직관적으로 파악할 수 있도록 시각적 요소를 강화했습니다.

- **정보 시각화**:
  - 게임 방의 핵심 정보인 **방 코드**와 **당첨 순위**를 별도의 정보 카드로 분리하여 가시성을 높였습니다.
- **라운드 결과 상세 표시**:
  - **도전 과제**: 단순히 탈락자 이름만 보여주는 것은 게임의 맥락을 이해하기 어렵게 했습니다.
  - **해결**: `RoundResultPayload` 타입을 확장하여, 해당 라운드에 참여한 모든 플레이어의 닉네임, 선택(가위/바위/보), 그리고 생존/탈락 여부를 포함하도록 했습니다. 프론트엔드에서는 이 정보를 받아 테이블 형태의 모달로 깔끔하게 표시하여, 플레이어가 '누가 무엇을 내서 탈락했는지' 명확히 알 수 있게 했습니다.

---

### Phase 5: 안정성 및 버그 수정

- **초기 로딩 문제 해결**:
  - **문제**: 사용자가 페이지를 새로고침하거나 URL로 직접 방에 접속하면, `update_room` 이벤트를 받기 전까지 플레이어 목록이 비어 보이는 현상이 있었습니다.
  - **해결**: `useEffect` 훅에서 방에 입장한 직후, `get_room` 이벤트를 서버로 보내 현재 방의 전체 상태를 즉시 요청하도록 로직을 추가했습니다. 이로써 어떤 상황에서든 일관된 UI를 제공할 수 있게 되었습니다.
- **무한 루프 방지**:
  - **오류**: `RangeError: Maximum call stack size exceeded`가 발생하는 것을 확인했습니다.
  - **원인 분석**: 모든 플레이어가 계속해서 무승부를 기록할 경우(e.g., 모두 같은 것을 내거나, 3명이 각각 다른 것을 냄), 게임이 끝나지 않고 `startRound` 함수가 무한히 호출되어 스택 오버플로우를 유발했습니다.
  - **해결**: `MAX_ROUNDS` (e.g., 50라운드)라는 상수를 도입하여, 이 횟수에 도달하면 게임을 강제 종료하고 현재 남은 플레이어들을 공동 순위로 처리하는 안전장치를 추가했습니다.

---

### 🔮 향후 개선 방향

- **사용자 인증 및 전적 시스템**: 유저 계정 시스템을 도입하여 개인의 승률, 달성 순위 등 전적을 기록하고 보여주는 기능.
- **다양한 게임 모드**: '팀전', '아이템전' 등 새로운 규칙을 추가하여 게임의 다양성을 확보.
- **공개 방 목록**: 친구와 함께하는 비공개 방 외에, 누구나 참여할 수 있는 공개 방 목록을 로비에 표시.
- **사운드 및 애니메이션**: 카드 선택, 타이머, 결과 발표 등 주요 인터랙션에 효과음과 부드러운 애니메이션을 추가하여 시청각적 경험을 강화.
